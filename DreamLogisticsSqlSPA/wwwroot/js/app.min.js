var myApp=angular.module("myApp",["ngRoute","myControllers"]),myControllers,isAdmin;myApp.config(["$routeProvider",function(n){n.when("/",{templateUrl:"/app/partials/login.html",controller:"LoginController"}).when("/queryList",{templateUrl:"/app/partials/queryList.html",controller:"QueryListController"}).when("/search/:queryId",{templateUrl:"/app/partials/search.html",controller:"SearchController"}).when("/result",{templateUrl:"/app/partials/result.html",controller:"ResultController"})}]);isAdmin=!0;isAdmin&&myApp.config(["$routeProvider",function(n){n.when("/create",{templateUrl:"/app/partials/createQuery.html",controller:"CreateController"}).when("/delete/:queryId",{templateUrl:"/app/partials/deleteQuery.html",controller:"DeleteController"}).when("/edit/:queryId",{templateUrl:"/app/partials/editQuery.html",controller:"EditController"}).when("/details/:queryId",{templateUrl:"/app/partials/queryDetails.html",controller:"DetailsController"})}]);myControllers=angular.module("myControllers",[]);isAdmin=!0;isAdmin&&myControllers.controller("CreateController",["$scope","$http",function(n,t){n.queryCreated=!1;n.formData={groupName:"",sql:""};n.formData.rows=[{name:"",typeId:0,parameterCode:"",tableName:"",displayColumn:"",keyColumn:"",paramOptional:""}];n.addRow=function(){n.formData.rows.push({name:"",typeId:0,parameterCode:"",tableName:"",displayColumn:"",keyColumn:"",paramOptional:""});console.log(n.formData.rows)};n.removeRow=function(t){n.formData.rows.splice(t,1)};n.addOptions=function(t){const i=document.getElementsByClassName("sql-options-"+t);if(n.formData.rows[t].typeId=="4")for(const n of i)n.style.display="block";else{for(const n of i)n.style.display="none";n.formData.rows[t].tableName="";n.formData.rows[t].displayColumn="";n.formData.rows[t].keyColumn=""}};n.createQuery=function(){console.log("Hallå?!?!?!?");angular.forEach(n.formData.rows,function(n){n.typeId=parseInt(n.typeId);n.paramOptional=n.paramOptional==0?!1:!0});t({method:"POST",url:"https://localhost:44313/api/query/Create",data:n.formData});n.queryCreated=!0}}]);myControllers.controller("DeleteController",["$scope","$http","$routeParams",function(n,t,i){n.queryDeleted=!1;t.get("https://localhost:44313/api/query/NoList/"+i.queryId).then(function(t){n.deleteInfo=t.data});n.deleteQuery=function(){t.delete("https://localhost:44313/api/query/DeleteQuery/"+i.queryId);n.queryDeleted=!0}}]);myControllers.controller("EditController",["$scope","$http","$routeParams",function(n,t,i){n.queryEdited=!1;n.deletedQueryParams=[];t.get("https://localhost:44313/api/query/NoList/"+i.queryId).then(function(t){n.editInfo=t.data;console.log(n.editInfo)});n.addOptions=function(t){const i=document.getElementsByClassName("sql-options-"+t);if(n.editInfo.queryParams[t].typeId=="4")for(const n of i)n.style.display="block";else{for(const n of i)n.style.display="none";n.editInfo.queryParams[t].tableName="";n.editInfo.queryParams[t].displayColumn="";n.editInfo.queryParams[t].keyColumn=""}};n.addRow=function(){n.editInfo.queryParams.push({name:"",typeId:0,parameterCode:"",tableName:"",displayColumn:"",keyColumn:"",paramRequired:""})};n.removeRow=function(t){var i=n.editInfo.queryParams[t].id;i!=undefined&&n.deletedQueryParams.push(i);n.editInfo.queryParams.splice(t,1)};n.editQuery=function(){angular.forEach(n.editInfo.queryParams,function(n){n.typeId=parseInt(n.typeId)});n.editInfo.queryParamsToDelete=n.deletedQueryParams;t({method:"PUT",url:"https://localhost:44313/api/query/UpdateQuery",data:n.editInfo});n.queryEdited=!0}}]);myControllers.controller("LoginController",["$scope","$http","$window",function(n,t,i){n.login={username:"",password:""};n.loginAttempt=function(){t.post("https://localhost:44313/api/Login/",n.login).then(function(t){n.userResult=t.data;n.userResult.username!=null?i.location.href="/#!/queryList":n.invalidUser="Felaktiga Inloggninsuppgifter"},function(n){console.log("error");console.log(n)})}}]);myControllers.controller("DetailsController",["$scope","$http","$routeParams",function(n,t,i){t.get("https://localhost:44313/api/query/NoList/"+i.queryId).then(function(t){n.queryInfo=t.data})}]);myControllers.controller("QueryListController",["$scope","$http",function(n,t){n.isAdmin=!0;t.get("https://localhost:44313/api/query").then(function(t){n.queries=t.data;console.log(n.queries);n.queries==0&&(n.noQueriesMessage="Det finns inga rapportmallar att välja på")});n.details=function(i){t.get("https://localhost:44313/api/query/NoList/"+i).then(function(t){n.query=t.data});const r=document.getElementById("details-option-"+i);r.style.display=r.style.display=="table-row"?"none":"table-row"};n.delete=function(n){const t=document.getElementById("delete-option-"+n);console.log(t.style.display);t.style.display=t.style.display=="table-row"?"none":"table-row"};n.closeAll=function(n){console.log(n);const t=document.getElementById("delete-option-"+n),i=document.getElementById("details-option-"+n);t.style.display="none";i.style.display="none"};n.deleteConfirmed=function(n){t.delete("https://localhost:44313/api/query/DeleteQuery/"+n);const i=document.getElementById("delete-option-"+n),r=document.getElementById("query-row-"+n),u=document.getElementById("details-option-"+n),f=document.getElementById("delete-message-top"),e=document.getElementById("delete-confirmed-"+n);r.style.display="none";u.style.display="none";i.style.display="none";e.style.display="table-row";f.style.display="block"};n.closeDeleteConfirmed=function(n){const t=document.getElementById("delete-confirmed-"+n),i=document.getElementById("delete-message-top");t.style.display="none";i.style.display="none"}}]);myControllers.controller("SearchController",["$scope","$http","$routeParams",function(n,t,i){function r(){var t;return n.validInputs=!0,t={QueryId:n.searchInfo.query.id,Parameters:[]},angular.forEach(n.searchInfo.queryParams,function(i){if(i.typeId==2){i.value=u(i.value);/^[0-9]{4}-[0-9]{2}-[0-9]{2}/.test(i.value)||(n.dateInputMessage="Ogiltligt Datum",n.validInputs=!1)}i.value!=null?t.Parameters.push({Id:i.id,Value:i.value.toString()}):t.Parameters.push({Id:i.id,Value:"null"})}),{valid:n.validInputs,payload:t}}function u(n){var r=new Date(n),t=""+(r.getMonth()+1),i=""+r.getDate(),u=r.getFullYear();return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),[u,t,i].join("-")}function f(n){var i=n.replace(/ /g,"_"),t=new Date,r=t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2),u=("0"+t.getHours()).slice(-2)+"_"+("0"+t.getMinutes()).slice(-2)+"_"+("0"+t.getSeconds()).slice(-2),f=r+" "+u;return i+" "+f+".xlsx"}n.searchCompleted=!1;t.get("https://localhost:44313/api/query/List/"+i.queryId).then(function(t){n.searchInfo=t.data});n.searchQueryExcel=function(){var i=r();i.valid&&t.post("https://localhost:44313/api/Search/Excel",i.payload,{responseType:"blob"}).then(function(t){var r=new Blob([t.data],{type:"application/octet-stream"}),u=URL.createObjectURL(r),e=f(n.searchInfo.query.groupName),i=document.createElement("a");i.href=u;i.target="_blank";i.download=e;document.body.appendChild(i);i.click();document.body.removeChild(i)},function(n){console.log("error");console.log(n)})};n.searchQuery=function(){var i=r();i.valid&&t.post("https://localhost:44313/api/Search/",i.payload).then(function(t){n.searchResult=t.data;n.searchCompleted=!0;console.log(n.searchResult)},function(n){console.log("error");console.log(n)})}}]);